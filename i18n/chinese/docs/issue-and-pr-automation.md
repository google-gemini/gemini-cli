# 自动化和分类流程

本文详细介绍了我们用于管理和分类问题 (issues) 和拉取请求 (pull requests) 的自动化流程。我们的目标是提供及时的反馈，并确保贡献得到高效的审查和集成。了解这些自动化将帮助您作为贡献者了解预期情况以及如何最好地与我们的仓库机器人互动。

## 指导原则：问题和拉取请求

首先，几乎每个拉取请求 (PR) 都应链接到相应的问题 (Issue)。问题描述了“什么”和“为什么”（错误或功能），而 PR 则是“如何”（实现）。这种分离有助于我们跟踪工作、确定功能优先级并维护清晰的历史上下文。我们的自动化是围绕这一原则构建的。

---

## 详细自动化工作流程

以下是我们仓库中运行的特定自动化工作流程的详细说明。

### 1. 当您创建问题时：`自动化问题分类`

这是您创建问题时将与之交互的第一个机器人。它的任务是执行初步分析并应用正确的标签。

- **工作流程文件**：`.github/workflows/gemini-automated-issue-triage.yml`
- **运行时间**：问题创建或重新打开后立即运行。
- **作用**：
  - 它使用 Gemini 模型根据一组详细的准则分析问题的标题和正文。
  - **应用一个 `area/*` 标签**：将问题分类到项目的某个功能区域（例如，`area/ux`、`area/models`、`area/platform`）。
  - **应用一个 `kind/*` 标签**：识别问题的类型（例如，`kind/bug`、`kind/enhancement`、`kind/question`）。
  - **应用一个 `priority/*` 标签**：根据描述的影响分配优先级，从 P0（关键）到 P3（低）。
  - **可能应用 `status/need-information`**：如果问题缺少关键细节（如日志或复现步骤），它将被标记为需要更多信息。
  - **可能应用 `status/need-retesting`**：如果问题引用的 CLI 版本已超过六个旧版本，它将被标记为需要在当前版本上重新测试。
- **您应该做什么**：
  - 尽可能完整地填写问题模板。您提供的细节越多，分类就越准确。
  - 如果添加了 `status/need-information` 标签，请在评论中提供所需详细信息。

### 2. 当您创建拉取请求时：`持续集成 (CI)`

此工作流程确保所有更改在合并之前都符合我们的质量标准。

- **工作流程文件**：`.github/workflows/ci.yml`
- **运行时间**：每次推送到拉取请求时。
- **作用**：
  - **Lint**：检查您的代码是否符合我们项目的格式和样式规则。
  - **测试**：在 macOS、Windows 和 Linux 以及多个 Node.js 版本上运行我们的全套自动化测试。这是 CI 过程中最耗时的部分。
  - **发布覆盖率评论**：所有测试成功通过后，机器人将在您的 PR 上发布评论。此评论提供了您的更改测试覆盖率的摘要。
- **您应该做什么**：
  - 确保所有 CI 检查通过。当一切成功时，您的提交旁边将出现一个绿色对勾 ✅。
  - 如果检查失败（红色“X”❌），请点击失败检查旁边的“Details”链接以查看日志，找出问题并推送修复。

### 3. 拉取请求的持续分类：`PR 审计和标签同步`

此工作流程定期运行，以确保所有打开的 PR 都正确链接到问题并具有一致的标签。

- **工作流程文件**：`.github/workflows/gemini-scheduled-pr-triage.yml`
- **运行时间**：每 15 分钟在所有打开的拉取请求上运行。
- **作用**：
  - **检查链接的问题**：机器人会扫描您的 PR 描述，查找将其链接到问题的关键字（例如，`Fixes #123`、`Closes #456`）。
  - **添加 `status/need-issue`**：如果未找到链接的问题，机器人将向您的 PR 添加 `status/need-issue` 标签。这是一个明确的信号，表明需要创建并链接一个问题。
  - **同步标签**：如果已链接问题，机器人会确保 PR 的标签与问题的标签完全匹配。它将添加任何缺失的标签并删除任何不属于的标签，如果存在 `status/need-issue` 标签，它将将其删除。
- **您应该做什么**：
  - **始终将您的 PR 链接到问题。** 这是最重要的一步。在您的 PR 描述中添加一行，例如 `Resolves #<issue-number>`。
  - 这将确保您的 PR 得到正确分类并顺利通过审查流程。

### 4. 问题的持续分类：`计划问题分类`

这是一个备用工作流程，用于确保没有问题被分类过程遗漏。

- **工作流程文件**：`.github/workflows/gemini-scheduled-issue-triage.yml`
- **运行时间**：每小时在所有打开的问题上运行。
- **作用**：
  - 它主动查找根本没有标签或仍带有 `status/need-triage` 标签的问题。
  - 然后，它会触发与初始分类机器人相同的基于 Gemini 的强大分析，以应用正确的标签。
- **您应该做什么**：
  - 您通常不需要做任何事情。此工作流程是一个安全网，用于确保每个问题最终都会被分类，即使初始分类失败。

### 5. 发布自动化

此工作流程处理 Gemini CLI 新版本的打包和发布过程。

- **工作流程文件**：`.github/workflows/release.yml`
- **运行时间**：每日计划用于“夜间”发布，并手动用于官方补丁/次要版本发布。
- **作用**：
  - 自动构建项目，提升版本号，并将包发布到 npm。
  - 在 GitHub 上创建相应的发布，并生成发布说明。
- **您应该做什么**：
  - 作为贡献者，您无需为此过程做任何事情。您可以确信，一旦您的 PR 合并到 `main` 分支，您的更改将包含在下一个夜间发布中。

我们希望这份详细的概述对您有所帮助。如果您对我们的自动化或流程有任何疑问，请随时提问！
